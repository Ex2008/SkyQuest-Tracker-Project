<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Exoâ€‘Ranker â€“ Earthâ€‘like Exoplanets</title>
  <style>
    :root{
      --navy:#0b0c10; --blue:#232931; --cyan:#66fcf1; --white:#fff;
      --panel-bg:rgba(35,41,49,.55); --border:rgba(102,252,241,.12);
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:"Segoe UI",Arial,sans-serif}
    body{min-height:100vh;display:flex;flex-direction:column;color:var(--white);
         background:linear-gradient(135deg,var(--navy)70%,var(--blue)100%)}
    header{display:flex;justify-content:space-between;align-items:center;padding:1rem 2rem;
           background:rgba(31,40,51,.6);backdrop-filter:blur(8px)}
    .logo{font-size:1.75rem;font-weight:700;color:var(--cyan)}
    main{flex:1;width:100%;max-width:1280px;margin:0 auto;padding:2rem}
    h1{font-size:2.3rem;margin-bottom:1rem;text-align:center}
    h1 span{color:var(--cyan)}
    /* â”€â”€â”€ tab buttons â”€â”€â”€ */
    .tab-buttons{display:flex;justify-content:center;gap:1rem;flex-wrap:wrap;margin-top:1.5rem}
    .tab-buttons button{padding:.6rem 1.2rem;background:#111;color:var(--white);border:1px solid var(--border);
                        border-radius:.5rem;cursor:pointer;font-size:1rem}
    .tab-buttons button.active{background:var(--cyan);color:#000}
    /* â”€â”€â”€ tab content areas â”€â”€â”€ */
    .tab-content{display:none;margin-top:1.6rem}
    .tab-content.active{display:block}
    #info{margin-top:1.6rem;padding:1rem;min-height:140px;background:var(--panel-bg);
          border:1px solid var(--border);border-radius:1rem}
    #info h2{color:var(--cyan);margin-bottom:.4rem}
    select{padding:.45rem .8rem;border-radius:.55rem;border:1px solid var(--border);
           background:#111;color:#fff;font-size:1rem;min-width:200px;margin:.3rem .6rem}
    optgroup[label]{color:var(--cyan);font-weight:bold}
  </style>
</head>
<body>
<header>
  <div class="logo">ğŸªÂ SkyQuestÂ /Â Exoâ€‘Ranker</div>
  <nav><a href="index.html" style="color:var(--cyan)">â†Â BackÂ Home</a></nav>
</header>

<main>
  <h1>Which <span>exoplanets</span> look most Earthâ€‘like?</h1>

  <!-- â”€â”€â”€ TABS â”€â”€â”€ -->
  <div class="tab-buttons">
    <button class="tabBtn active" data-tab="scatter">ğŸ§­ Scatter</button>
    <button class="tabBtn" data-tab="rankTab">ğŸ“Š Rankings</button>
    <button class="tabBtn" data-tab="radarTab">ğŸ•¸ï¸ Radar</button>
    <button class="tabBtn" data-tab="heatTab">ğŸŒ¡ Heatmap</button>
    <button class="tabBtn" data-tab="parTab">ğŸ“ˆ Parallel</button>
  </div>

  <!-- â”€â”€â”€ SCATTER â”€â”€â”€ -->
  <div id="scatter" class="tab-content active">
    <p style="text-align:center">Choose any two numerical parameters to explore the full catalogue.</p>
    <div style="text-align:center;margin-top:1rem">
      <label for="xSel">Xâ€‘axis</label><select id="xSel"></select>
      <label for="ySel" style="margin-left:.9rem">Yâ€‘axis</label><select id="ySel"></select>
    </div>
    <div id="scatterChart" style="height:620px"></div>
  </div>

  <!-- â”€â”€â”€ RANKINGS â”€â”€â”€ -->
  <div id="rankTab" class="tab-content"><div id="rankingsChart" style="height:520px"></div></div>

  <!-- â”€â”€â”€ RADAR â”€â”€â”€ -->
  <div id="radarTab" class="tab-content"><div id="radarChart" style="height:520px"></div></div>

  <!-- â”€â”€â”€ HEATMAP â”€â”€â”€ -->
  <div id="heatTab"  class="tab-content"><div id="heatChart"  style="height:520px"></div></div>

  <!-- â”€â”€â”€ PARALLEL â”€â”€â”€ -->
  <div id="parTab"   class="tab-content"><div id="parChart"   style="height:520px"></div></div>

  <div id="info"><em>Click a point in any chart to read its explainer.</em></div>
</main>

<!-- â”€â”€â”€ Plotly CDN â”€â”€â”€ -->
<script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
<script>
/* ---------- palette & key features ---------- */
const palette = ['#66fcf1','#ffcc00','#ff6666','#9966ff','#00d084','#ff7eb3','#ffa600'];
const radarKeys = ['pl_rade','pl_bmasse','pl_insol','pl_orbeccen','st_teff']; // 5â€‘axis radar
const featureLabels = {
  pl_rade:"Radius (RâŠ•)",pl_bmasse:"Mass (MâŠ•)",pl_insol:"Insolation (SâŠ•)",
  pl_orbeccen:"Eccentricity",st_teff:"Star T (K)"
};
/* -------- dropdown categories (only for scatter) ------- */
const featureCategories={
 'Planet Size':['pl_rade','pl_radeerr1','pl_radeerr2'],
 'Planet Mass':['pl_bmasse','pl_bmasseerr1','pl_bmasseerr2'],
 'Orbit':['pl_orbper','pl_orbsmax','pl_orbeccen'],
 'Star':['st_teff','st_rad','st_mass'],
 'Energy':['pl_insol','pl_eqt']
};

/* ---------- helpers ---------- */
const byId = id=>document.getElementById(id);
function norm(val,min,max){return (val-min)/(max-min);}
function makeTabs(){
  document.querySelectorAll('.tabBtn').forEach(btn=>{
    btn.onclick=()=>{
      document.querySelectorAll('.tabBtn').forEach(b=>b.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
      btn.classList.add('active');
      byId(btn.dataset.tab).classList.add('active');
      Plotly.Plots.resize(document.querySelector('.tab-content.active div[id$="Chart"]'));
    };
  });
}

/* ---------- fetch data & init ---------- */
(async()=>{
  const res = await fetch('planet_data.json');
  const data = await res.json();
  makeTabs();
  fillDropdowns(data);
  drawScatter(data);
  drawRankings(data);
  drawRadar(data,'Earth');          // default radar Earth vs Earth
  drawHeat(data);
  drawParallel(data);

  // scatter click updates info + radar
  byId('scatterChart').on('plotly_click',ev=>{
    const p = ev.points[0].customdata;
    showInfo(p);
    drawRadar(data,p.pl_name);
  });
  // rankings click behaves similarly
  byId('rankingsChart').on('plotly_click',ev=>{
    const p = ev.points[0].customdata;
    showInfo(p);
    drawRadar(data,p.pl_name);
    // also jump to radar tab
    document.querySelector('[data-tab="radarTab"]').click();
  });

  byId('xSel').onchange=()=>drawScatter(data);
  byId('ySel').onchange=()=>drawScatter(data);
})();

/* ---------- UI builders ---------- */
function fillDropdowns(data){
  const xSel=byId('xSel'), ySel=byId('ySel');
  for(const [group,keys] of Object.entries(featureCategories)){
    const gX=document.createElement('optgroup'), gY=document.createElement('optgroup');
    gX.label=gY.label=group;
    keys.forEach(k=>{
      let lab=k+(featureLabels[k]?` â€“ ${featureLabels[k]}`:'');
      gX.appendChild(new Option(lab,k)); gY.appendChild(new Option(lab,k));
    });
    xSel.appendChild(gX); ySel.appendChild(gY);
  }
  xSel.value='pl_rade'; ySel.value='pl_bmasse';
}

/* ---------- Scatter ---------- */
function drawScatter(data){
  const x=byId('xSel').value, y=byId('ySel').value;
  const clusters=[...new Set(data.map(d=>d.cluster||0))].sort();
  const traces=clusters.map((c,i)=>{
    const pts=data.filter(d=>d.cluster===c && d.pl_name!=='Earth');
    return{
      x:pts.map(p=>p[x]), y:pts.map(p=>p[y]), text:pts.map(p=>p.pl_name),
      customdata:pts, mode:'markers', type:'scatter', name:`Cluster ${c}`,
      marker:{color:palette[i%palette.length],size:7,opacity:0.8}
    };
  });
  const earth=data.find(p=>p.pl_name==='Earth');
  if(earth){
    traces.push({x:[earth[x]],y:[earth[y]],text:['ğŸŒ Earth'],customdata:[earth],
      mode:'markers+text',type:'scatter',name:'ğŸŒ Earth',
      textposition:'top center', marker:{color:'#FFD700',size:16,symbol:'star',line:{color:'#222',width:2}}});
  }
  Plotly.newPlot('scatterChart',traces,
    {title:`${x} vs ${y}`,template:'plotly_dark',legend:{orientation:'h'},margin:{l:60,r:20,t:60,b:60},
     xaxis:{title:x},yaxis:{title:y}}, {responsive:true});
}

/* ---------- Rankings ---------- */
function drawRankings(data){
  const ranked=data.filter(p=>p.pl_name!=='Earth'&&p.pl_rade&&p.pl_bmasse)
    .map(p=>{
      const diffR=Math.abs(p.pl_rade-1), diffM=Math.abs(p.pl_bmasse-1);
      return {...p,sim:1/(1+diffR+diffM)};
    }).sort((a,b)=>b.sim-a.sim).slice(0,10);
  Plotly.newPlot('rankingsChart',[{
    type:'bar',orientation:'h',
    x:ranked.map(p=>p.sim.toFixed(3)).reverse(),
    y:ranked.map(p=>p.pl_name).reverse(),
    text:ranked.map(p=>p.pl_name),customdata:ranked,
    marker:{color:'#66fcf1'}
  }],{title:'Topâ€‘10 Earthâ€‘like (radius & mass)',template:'plotly_dark',
      margin:{l:100,r:20,t:60,b:40},xaxis:{title:'Similarity'},yaxis:{automargin:true}});
}

/* ---------- Radar ---------- */
function drawRadar(data,planetName){
  const planet=data.find(p=>p.pl_name===planetName)||data[0];
  const earth =data.find(p=>p.pl_name==='Earth');
  const theta=radarKeys.map(k=>featureLabels[k]);
  const pVals=radarKeys.map(k=>planet[k]);
  const eVals=radarKeys.map(k=>earth[k]);
  Plotly.newPlot('radarChart',[
    {type:'scatterpolar',r:eVals,theta,fill:'toself',name:'Earth',line:{color:'#FFD700'}},
    {type:'scatterpolar',r:pVals,theta,fill:'toself',name:planet.pl_name,
     customdata:[planet],line:{color:'#66fcf1'}}
  ],{polar:{radialaxis:{visible:true}},template:'plotly_dark',
     title:`Earth vs ${planet.pl_name}`,margin:{t:60}});
}

/* ---------- Heatmap ---------- */
function drawHeat(data){
  const xs=data.map(p=>p.pl_rade);
  const ys=data.map(p=>p.pl_bmasse);
  const zs=data.map(p=>p.pl_eqt||0);
  Plotly.newPlot('heatChart',[{
    x:xs,y:ys,z:zs,customdata:data,type:'histogram2d',
    colorscale:'Viridis',colorbar:{title:'EQT (K)'}
  }],{title:'Radius vs Mass â€“ coloured by Eq.Temp',template:'plotly_dark',
      xaxis:{title:'Radius (RâŠ•)'},yaxis:{title:'Mass (MâŠ•)'}});
}

/* ---------- Parallel Coordinates ---------- */
function drawParallel(data){
  const dims = radarKeys.map(k=>({
      range:[Math.min(...data.map(d=>d[k]||0)), Math.max(...data.map(d=>d[k]||0))],
      label:featureLabels[k], values:data.map(d=>d[k]||0)
  }));
  Plotly.newPlot('parChart',[{type:'parcoords',dimensions:dims,
      line:{color:data.map(d=>d.cluster||0),colorscale:'Jet'}}],
      {title:'Parallel Coordinates (5 key features)',template:'plotly_dark'});
}

/* ---------- Info card ---------- */
function showInfo(p){
  byId('info').innerHTML=`<h2>${p.pl_name}</h2>
    <p><strong>Cluster:</strong> ${p.cluster??'N/A'} â€¢ <strong>Temp class:</strong> ${p.temp_class??'â€“'}</p>
    <p>${p.explanation??'No description yet.'}</p>`;
}
</script>
</body>
</html>
