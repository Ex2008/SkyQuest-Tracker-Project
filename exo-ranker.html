<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Exo‚Äã-Ranker ‚Äì Earth-like Exoplanets</title>
  <style>
    :root {
      --navy: #0b0c10;
      --blue: #232931;
      --cyan: #66fcf1;
      --purple: #7f7fd5;
      --white: #fff;
      --panel-bg: rgba(35, 41, 49, .55);
      --border: rgba(102, 252, 241, .12);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: "Segoe UI", Arial, sans-serif
    }

    body {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: var(--white);
      background: linear-gradient(135deg, var(--navy) 70%, var(--blue) 100%);
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background: rgba(31, 40, 51, .6);
      backdrop-filter: blur(8px);
    }

    .logo {
      font-size: 1.75rem;
      font-weight: 700;
      color: var(--cyan)
    }

    main {
      flex: 1;
      width: 100%;
      max-width: 1280px;
      margin: 0 auto;
      padding: 2rem;
      text-align: center
    }

    h1 {
      font-size: 2.3rem;
      margin-bottom: 1rem
    }

    h1 span {
      color: var(--cyan)
    }

    select {
      padding: .45rem .8rem;
      border-radius: .55rem;
      border: 1px solid var(--border);
      background: #111;
      color: #fff;
      font-size: 1rem;
      min-width: 220px;
      margin: .3rem .6rem;
    }

    #chart,
    #rankings {
      margin-top: 1.8rem;
      border: 1px solid var(--border);
      border-radius: 1rem;
    }

    #chart {
      height: 620px;
    }

    #rankings {
      height: 400px;
      margin-top: 2rem;
    }

    #info {
      margin-top: 1.5rem;
      padding: 1rem;
      min-height: 140px;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 1rem;
    }

    #info h2 {
      color: var(--cyan);
      margin-bottom: .4rem
    }

    optgroup[label] {
      color: var(--cyan);
      font-weight: bold;
    }
  </style>
</head>

<body>
  <header>
    <div class="logo">ü™ê SkyQuest / Exo‚Äã-Ranker</div>
    <nav><a href="index.html">‚Üê Back Home</a></nav>
  </header>

  <main>
    <h1>Which <span>exoplanets</span> look most Earth‚Äã-like?</h1>
    <p>Choose any two numerical parameters to explore the full catalogue.</p>
    <div style="margin-top:1.2rem">
      <label for="xSel">X‚Äã-axis</label>
      <select id="xSel"></select>
      <label for="ySel" style="margin-left:.9rem">Y‚Äã-axis</label>
      <select id="ySel"></select>
    </div>
    <div id="chart"></div>
    <div id="rankings"></div>
    <div id="info"><em>Click a planet dot to read its 150-word explainer.</em></div>
  </main>

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script>
    const palette = ['#66fcf1', '#ffcc00', '#ff6666', '#9966ff', '#00d084', '#ff7eb3', '#ffa600'];
    const keyFeatures = ['pl_rade', 'pl_bmasse', 'pl_eqt', 'st_teff', 'st_rad', 'st_mass'];

    const featureCategories = {
      'Key Features': ['pl_rade', 'pl_bmasse', 'pl_eqt', 'st_teff', 'st_rad', 'st_mass'],
      'Orbital & Discovery': ['pl_orbper', 'pl_orbpererr1', 'pl_orbpererr2', 'pl_orbperlim', 'pl_orbsmax', 'pl_orbsmaxerr1', 'pl_orbsmaxerr2', 'pl_orbsmaxlim', 'pl_orbeccen', 'pl_orbeccenerr1', 'pl_orbeccenerr2', 'pl_orbeccenlim'],
      'Radius & Mass': ['pl_radeerr1', 'pl_radeerr2', 'pl_radelim', 'pl_radj', 'pl_radjerr1', 'pl_radjerr2', 'pl_radjlim', 'pl_bmasseerr1', 'pl_bmasseerr2', 'pl_bmasselim', 'pl_bmassj', 'pl_bmassjerr1', 'pl_bmassjerr2', 'pl_bmassjlim', 'pl_bmassprov'],
      'Energy & Temperature': ['pl_insol', 'pl_insolerr1', 'pl_insolerr2', 'pl_insollim', 'pl_eqterr1', 'pl_eqterr2', 'pl_eqtlim'],
      'Star Parameters': ['st_spectype', 'st_tefferr1', 'st_tefferr2', 'st_tefflim', 'st_raderr1', 'st_raderr2', 'st_radlim', 'st_masserr1', 'st_masserr2', 'st_masslim', 'st_met', 'st_meterr1', 'st_meterr2', 'st_metlim', 'st_metratio', 'st_logg', 'st_loggerr1', 'st_loggerr2', 'st_logglim'],
      'Distance & Brightness': ['sy_dist', 'sy_disterr1', 'sy_disterr2', 'sy_vmag', 'sy_vmagerr1', 'sy_vmagerr2', 'sy_kmag', 'sy_kmagerr1', 'sy_kmagerr2', 'sy_gaiamag', 'sy_gaiamagerr1', 'sy_gaiamagerr2'],
      'Discovery & Flags': ['disc_year', 'discoverymethod', 'disc_facility', 'pl_controv_flag', 'ttv_flag', 'sy_snum', 'sy_pnum']
    };

    const featureLabels = {
      pl_rade: "Planet Radius (R‚äï)", pl_bmasse: "Planet Mass (M‚äï)", pl_eqt: "Equilibrium Temperature (K)", st_teff: "Star Temperature (K)", st_rad: "Star Radius (R‚òâ)", st_mass: "Star Mass (M‚òâ)",
      pl_orbper: "Orbital Period (days)", pl_orbpererr1: "Orbital Period Error (+)", pl_orbpererr2: "Orbital Period Error (‚Äì)", pl_orbperlim: "Orbital Period Limit Flag", pl_orbsmax: "Orbit Semi-Major Axis (AU)", pl_orbsmaxerr1: "Axis Error (+)", pl_orbsmaxerr2: "Axis Error (‚Äì)", pl_orbsmaxlim: "Axis Limit Flag", pl_orbeccen: "Orbital Eccentricity", pl_orbeccenerr1: "Eccentricity Error (+)", pl_orbeccenerr2: "Eccentricity Error (‚Äì)", pl_orbeccenlim: "Eccentricity Limit Flag",
      pl_radeerr1: "Radius Error (+)", pl_radeerr2: "Radius Error (‚Äì)", pl_radelim: "Radius Limit Flag", pl_radj: "Radius (Jupiter)", pl_radjerr1: "Radius (Jupiter) Error (+)", pl_radjerr2: "Radius (Jupiter) Error (‚Äì)", pl_radjlim: "Radius (Jupiter) Limit Flag", pl_bmasseerr1: "Mass Error (+)", pl_bmasseerr2: "Mass Error (‚Äì)", pl_bmasselim: "Mass Limit Flag", pl_bmassj: "Mass (Jupiter)", pl_bmassjerr1: "Mass (Jupiter) Error (+)", pl_bmassjerr2: "Mass (Jupiter) Error (‚Äì)", pl_bmassjlim: "Mass (Jupiter) Limit Flag", pl_bmassprov: "Mass Provenance",
      pl_insol: "Stellar Insolation (S‚äï)", pl_insolerr1: "Insolation Error (+)", pl_insolerr2: "Insolation Error (‚Äì)", pl_insollim: "Insolation Limit Flag", pl_eqterr1: "Equilibrium Temp Error (+)", pl_eqterr2: "Equilibrium Temp Error (‚Äì)", pl_eqtlim: "Equilibrium Temp Limit Flag",
      st_spectype: "Spectral Type", st_tefferr1: "Star Temp Error (+)", st_tefferr2: "Star Temp Error (‚Äì)", st_tefflim: "Star Temp Limit Flag", st_raderr1: "Star Radius Error (+)", st_raderr2: "Star Radius Error (‚Äì)", st_radlim: "Star Radius Limit Flag", st_masserr1: "Star Mass Error (+)", st_masserr2: "Star Mass Error (‚Äì)", st_masslim: "Star Mass Limit Flag", st_met: "Metallicity", st_meterr1: "Metallicity Error (+)", st_meterr2: "Metallicity Error (‚Äì)", st_metlim: "Metallicity Limit", st_metratio: "Metallicity Ratio", st_logg: "Surface Gravity (log g)", st_loggerr1: "Gravity Error (+)", st_loggerr2: "Gravity Error (‚Äì)", st_logglim: "Gravity Limit",
      sy_dist: "System Distance (pc)", sy_disterr1: "Distance Error (+)", sy_disterr2: "Distance Error (‚Äì)", sy_vmag: "Visual Magnitude (V)", sy_vmagerr1: "Vmag Error (+)", sy_vmagerr2: "Vmag Error (‚Äì)", sy_kmag: "Infrared Magnitude (K)", sy_kmagerr1: "Kmag Error (+)", sy_kmagerr2: "Kmag Error (‚Äì)", sy_gaiamag: "Gaia Magnitude", sy_gaiamagerr1: "GaiaMag Error (+)", sy_gaiamagerr2: "GaiaMag Error (‚Äì)",
      disc_year: "Discovery Year", discoverymethod: "Discovery Method", disc_facility: "Discovery Facility", pl_controv_flag: "Controversial Detection", ttv_flag: "TTV Flag", sy_snum: "# Stars in System", sy_pnum: "# Planets in System"
    };

    const populateDropdowns = () => {
      const xSel = document.getElementById('xSel');
      const ySel = document.getElementById('ySel');
      for (const [groupName, keys] of Object.entries(featureCategories)) {
        const groupX = document.createElement('optgroup');
        const groupY = document.createElement('optgroup');
        groupX.label = groupY.label = groupName;
        keys.forEach(k => {
          const label = featureLabels[k] || k;
          const optX = new Option(`${k} ‚Äì ${label}`, k);
          const optY = new Option(`${k} ‚Äì ${label}`, k);
          groupX.appendChild(optX);
          groupY.appendChild(optY);
        });
        xSel.appendChild(groupX);
        ySel.appendChild(groupY);
      }
      xSel.value = 'pl_rade';
      ySel.value = 'pl_bmasse';
    };

    const plotChart = (data) => {
      const x = xSel.value, y = ySel.value;
      const xLabel = featureLabels[x] || x;
      const yLabel = featureLabels[y] || y;
      const clusters = [...new Set(data.map(d => d.cluster))].sort();
      const traces = clusters.map((c, i) => {
        const pts = data.filter(d => d.cluster === c && d.pl_name !== "Earth");
        return {
          x: pts.map(p => p[x]),
          y: pts.map(p => p[y]),
          text: pts.map(p => p.pl_name),
          customdata: pts,
          mode: 'markers',
          type: 'scatter',
          name: `Cluster ${c}`,
          marker: { color: palette[i % palette.length], size: 7, opacity: 0.8 }
        };
      });
      const earth = data.find(p => p.pl_name === "Earth");
      if (earth) {
        traces.push({
          x: [earth[x]],
          y: [earth[y]],
          text: ["üåç Earth"],
          customdata: [earth],
          mode: 'markers+text',
          type: 'scatter',
          name: 'üåç Earth',
          textposition: 'top center',
          marker: { color: '#FFD700', size: 18, symbol: 'star', line: { color: '#000', width: 2 } }
        });
      }
      Plotly.newPlot('chart', traces, {
        title: `${xLabel} vs ${yLabel}`,
        xaxis: { title: xLabel },
        yaxis: { title: yLabel },
        template: 'plotly_dark',
        margin: { l: 60, r: 20, t: 60, b: 60 },
        legend: { orientation: 'h', x: 0.01, y: 1.3 },
        dragmode: 'pan'
      }, { responsive: true });
    };

    const plotRankings = (data) => {
      // ---------- compute similarity ----------
      const ranked = data
        .filter(p => p.pl_name !== 'Earth')           // omit Earth
        .map(p => {
          let sumSq = 0; let counted = 0;
          keyFeatures.forEach(k => {
            if (p[k] != null) {                       // skip null / undefined
              const diff = (p[k] - earthRef[k]);
              sumSq += diff * diff;
              counted++;
            }
          });
          const dist = Math.sqrt(sumSq);              // Euclidean distance
          let sim = 1 - dist;                         // raw similarity (may go <‚ÄØ0)
          if (sim < 0) sim = 0;                       // clamp to 0
          p.similarity = sim;
          return p;
        })
        .sort((a, b) => b.similarity - a.similarity)  // best first
        .slice(0, 10);                                // top‚Äë10

      // ---------- make bar chart ----------
      Plotly.newPlot('rankingsChart', [{
        type: 'bar',
        x: ranked.map(p => p.similarity.toFixed(3)).reverse(),
        y: ranked.map(p => p.pl_name).reverse(),
        orientation: 'h',
        text: ranked.map(p => p.pl_name),
        customdata: ranked,           // so clicks still work
        marker: { color: '#66fcf1' }
      }], {
        title: 'Top‚Äë10 Earth‚Äëlike Planets (6‚Äëfeature similarity)',
        xaxis: { title: 'Earth Similarity (1¬†=¬†identical)', range: [0, 1] },
        yaxis: { automargin: true },
        template: 'plotly_dark',
        margin: { l: 120, r: 20, t: 60, b: 40 }
      });
    };

    (async () => {
      try {
        const res = await fetch('planet_data.json');
        const data = await res.json();
        populateDropdowns();
        plotChart(data);
        plotRankings(data);
        xSel.onchange = () => plotChart(data);
        ySel.onchange = () => plotChart(data);
        document.getElementById('chart').addEventListener('plotly_click', ev => {
          const p = ev.detail.points[0].customdata;
          document.getElementById('info').innerHTML = `<h2>${p.pl_name}</h2><p><strong>Cluster:</strong> ${p.cluster} ‚Ä¢ <strong>Temp class:</strong> ${p.temp_class}</p><p>${p.explanation}</p>`;
        });
      } catch (err) {
        document.getElementById('chart').innerHTML = '<p style="padding:2rem">Could not load <code>planet_data.json</code>.</p>';
      }
    })();
  </script>
</body>

</html>