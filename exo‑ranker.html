<!-- exo-ranker.html  |  place at repo root -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Exoâ€‘Ranker â€“ Earthâ€‘like Exoplanets</title>

  <style>
    :root{--glass-purple:#7f7fd5;--stellar-cyan:#66fcf1;--deep-navy:#0b0c10;--white:#ffffff;}
    body{margin:0;font-family:"Segoe UI",Arial,sans-serif;
         background:linear-gradient(135deg,#0b0c10 70%,#232931 100%);
         color:#fff;min-height:100vh;display:flex;flex-direction:column;}
    header{display:flex;justify-content:space-between;align-items:center;
           padding:1rem 2rem;background:rgba(31,40,51,.6);
           backdrop-filter:blur(8px);}
    .logo{font-size:1.6rem;font-weight:700;color:var(--stellar-cyan);}    
    nav a{color:var(--white);text-decoration:none;font-weight:600;}
    nav a:hover{text-decoration:underline;}
    .exo-link{background:var(--glass-purple);color:var(--white);padding:.55rem 1.25rem;border-radius:1.6rem;font-weight:700;box-shadow:0 0 18px rgba(127,127,213,.45);transition:transform .15s;}
    .exo-link:hover{transform:translateY(-2px) scale(1.05);}    
    main{flex:1;padding:2rem;max-width:1280px;margin:0 auto;}
    #root{min-height:70vh;}
    .api-key{margin:1rem 0;max-width:420px;width:100%;padding:.6rem;border-radius:.5rem;border:1px solid #666;background:#111;color:#eee;}
  </style>
</head>

<body>
  <header>
    <div class="logo">ğŸªÂ SkyQuestÂ /Â Exoâ€‘Ranker</div>
    <nav><a class="exo-link" href="index.html">â†Â BackÂ Home</a></nav>
  </header>

  <main>
    <h1 style="font-size:2.6rem;margin-bottom:.6rem">Exoâ€‘Ranker:
      <span style="color:var(--stellar-cyan)">Which exoplanets look most Earthâ€‘like?</span>
    </h1>
    <p>Paste your <strong>OpenAI&nbsp;APIâ€¯key</strong> to unlock AI clustering and planet
       explanations:</p>
    <input id="key" class="api-key" type="password" placeholder="skâ€‘..." />

    <!-- React app mounts here -->
    <div id="root"></div>
  </main>

  <!-- â”€â”€â”€ dependencies (UMD/ESM via CDN) â”€â”€â”€ -->
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/recharts/umd/Recharts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/ml-kmeans@3/dist/ml-kmeans.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/babel-standalone@6/babel.min.js"></script>

  <!-- â”€â”€â”€ Exoâ€‘Ranker component (transpiled onâ€‘theâ€‘fly) â”€â”€â”€ -->
  <script type="text/babel">
    const {ScatterChart, Scatter, XAxis, YAxis, Tooltip, ResponsiveContainer} = Recharts;

    function tempClass(k){
      if(k==null) return "Unknown";
      if(k<255) return "Frozen";
      if(k<=330) return "Temperate";
      return "Hot";
    }

    function ExoRanker(){
      const [planets,setPlanets]=React.useState([]);
      const [loading,setLoading]=React.useState(true);
      const [apiKey,setApiKey]=React.useState("");
      const [selected,setSelected]=React.useState(null);

      React.useEffect(()=>{
        fetch("https://exoplanetarchive.ipac.caltech.edu/TAP/sync?query="+
              encodeURIComponent("select pl_name,pl_eqt,pl_rade,pl_masse from pscomppars where pl_eqt is not null and pl_rade is not null limit 200")+
              "&format=json")
          .then(r=>r.json())
          .then(d=>{setPlanets(d);setLoading(false);});
      },[]);

      React.useEffect(()=>{
        if(!apiKey||!planets.length) return;
        (async()=>{
          const enriched=[];
          for(const p of planets){
            const vec=[p.pl_rade||0,p.pl_masse||0,p.pl_eqt||0];
            const emb=await fetch("https://api.openai.com/v1/embeddings",{
              method:"POST",
              headers:{"Content-Type":"application/json",Authorization:`Bearer ${apiKey}`},
              body:JSON.stringify({model:"text-embedding-3-small",input:vec.join(",")})
            }).then(r=>r.json()).then(j=>j.data[0].embedding);
            enriched.push({...p,embedding:emb,tempClass:tempClass(p.pl_eqt)});
          }
          const km=mlKmeans(enriched.map(e=>e.embedding),4);
          enriched.forEach((p,i)=>p.cluster=km.clusters[i]);
          setPlanets(enriched);
        })();
      },[apiKey]);

      if(loading) return <p>Loading NASA catalogueâ€¦</p>;

      return (
        <>
          <input className="api-key" type="password" placeholder="OpenAI key here" value={apiKey} onChange={e=>setApiKey(e.target.value)} />
          <ResponsiveContainer width="100%" height={400}>
            <ScatterChart>
              <XAxis dataKey="pl_rade" name="Radius (RâŠ•)" />
              <YAxis dataKey="pl_eqt" name="EqTemp (K)" />
              <Tooltip cursor={{strokeDasharray:"3 3"}} />
              {[0,1,2,3].map(c=>(
                <Scatter key={c} data={planets.filter(p=>p.cluster===c)} fill="currentColor" opacity={0.75} onClick={({payload})=>setSelected(payload)} />
              ))}
            </ScatterChart>
          </ResponsiveContainer>
          {selected && <PlanetCard planet={selected} apiKey={apiKey} />}
        </>
      );
    }

    function PlanetCard({planet,apiKey}){
      const [text,setText]=React.useState("");
      React.useEffect(()=>{
        if(!apiKey||text) return;
        fetch("https://api.openai.com/v1/chat/completions",{
          method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${apiKey}`},
          body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:"You are a concise science communicator."},{role:"user",content:`In ~150 words, explain why ${planet.pl_name} is interesting. Radius ${planet.pl_rade} R_earth, Mass ${planet.pl_masse} M_earth, EqTemp ${planet.pl_eqt} K.`}],max_tokens:220})
        }).then(r=>r.json()).then(j=>setText(j.choices[0].message.content.trim()));
      },[apiKey,planet]);

      return (
        <div style={{marginTop:"1.5rem",padding:"1rem",background:"rgba(35,41,49,.5)",borderRadius:"1rem"}}>
          <h2 style={{color:"var(--stellar-cyan)"}}>{planet.pl_name}</h2>
          <p><strong>Temp class:</strong> {planet.tempClass}</p>
          <p style={{whiteSpace:"pre-wrap"}}>{text||"Loading explanationâ€¦"}</p>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<ExoRanker/>);
  </script>
</body>
</html>
